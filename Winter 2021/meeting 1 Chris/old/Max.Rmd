---
title: "Maximization"
author: "Siya Qiu"
date: "1/10/2021"
output: 
  html_document: 
    toc: yes
    toc_float: yes
    theme: cerulean
---

**This Rmd is created because we are going to do maximization year by year. Instead of finding the max PVNB over the study period, we will do maximization from the fishermen perspective, which is to maximize the profit of the current year. Then use the stock dynamic result from this year to guide the fishing behavior for next year.**

### Section I: Set Parameters
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message=F, warning=F)

# Packages
library(tidyverse)
library(Matrix)
library(kableExtra)
library(ggplot2)
library(plotly)
library(lpSolve)
library(lpSolveAPI)
library(ggpubr)
```

```{r} 
# First, set seed to ensure we have the same result 
set.seed(666)


# set the number of species and technologies we want to study
species_num <- 2
tech_num <- 2


# set the number of years we want to model the stock dynamic 
year = 3

# set the discount rate
delta = 0.05
rho = 1/(1+delta)


# set parameters
species <- c(1:species_num)
parameter <- data.frame(species)
parameter$r <- c(1,1)
parameter$K <- c(1,1)
parameter$X0 <- c(0.5,0.5)
parameter$p <- c(200,200)
parameter$delta <- c(0.05,0.05)
parameter$rho <- 1/(1+parameter$delta)

# set catchability coefficient 
coefficient <- c(0.05,0.04,0.04,0.05)
q_matrix <- matrix(coefficient, nrow = tech_num, ncol = species_num, byrow=T)

# set effort for each tech 
E <- c(0.5,0.5)

# set cost for each tech
C <- c(1,1)

# set the quota basket for E
QB_E = 15

QB_H = 0.8
```

We will keep our model simple first.  Here we create a model of `r tech_num` technologies and `r species_num` species for a study period of `r year` years. The price of fish only depends on species (will add in more attributes later).

```{r}
# print the parameter table
par <- kbl(parameter, caption = "Species Parameters") %>% 
  kable_classic(full_width = F, html_font = "Cambria")
par
```

```{r}
# q_matrix <- matrix(coefficient, nrow = tech_num, ncol = species_num)
species_tech_matrix <- data.frame(q_matrix)

# assign column and row names to the matrix
matrix_col_name <-  paste("species", 1:species_num, sep = " ")
colnames(species_tech_matrix) <- matrix_col_name
matrix_row_name <-  paste("tech", 1:tech_num, sep = " ")
rownames(species_tech_matrix) <- matrix_row_name
```

```{r}
# print the catchability table 
matrix_table = kbl(species_tech_matrix, caption = "Catchability Matrix") %>% 
  kable_classic(full_width = F, html_font = "Cambria")
matrix_table
```

### Section II: Maximize Profit for linear cost 

**Profit**: <br>
$$\pi = \sum_{i=1}^{techNum}[(\sum_{j=1}^{speciesNum} p_j \times q_{i,j}E_iX_{j}) - C_iE_i]
$$<br>


Since we are doing optimization year by year, let's see how the first year goes. 
<br>
<br>
Given $X0$ (initial stock size), the profit for the first year will be:

$$
(E_1, E_2)_{E}
\times 
\begin{pmatrix}
0.05&0.04\\
0.04&0.05\\
\end{pmatrix}_q
\times 
\begin{pmatrix}
200 \times 0.5\\
200 \times 0.5\\
\end{pmatrix}_{p \ \times \ X0}
-
(E_1, E_2)_{E}
\times 
\begin{pmatrix}
1\\
1\\
\end{pmatrix}_{C}
$$
$= (E_10.05+E_20.04)\times 100 + (E_10.04+E_20.05)\times 100 - (E_1 + E_2)$<br>
$= 5E_1 + 4E_2+4E_1+5E_2-E_1-E_2$<br>
$= 8E_1-8E_2$<br>
<br>
Let $f(E) = 8E_1-8E_2$, <br>

$$\nabla f(E) = 
\begin{pmatrix}
8\\
8\\
\end{pmatrix}_{Gradient}
$$<br>

**The calculation will stop right here, since the partial derivative for all the variables (E) are constants. This means profit will change at a constant rate at the direction of each of the variable (i.e. we don't need to look for max or min because this is a line. The endpoints are the max or mix.)**
<br>
<br>

##### **Conclusion: no solution for the linear cost case.**
<br>

### Section III: Optimization for non linear cost 

**Profit**: <br>
$$\pi = \sum_{i=1}^{techNum}[(\sum_{j=1}^{speciesNum} p_j \times q_{i,j}E_iX_{j}) - C_i^\beta E_i]
$$<br>

##### **Conclusion: will be the same as above.**